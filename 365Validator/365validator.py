import requests
import argparse
import time

parser = argparse.ArgumentParser()
parser.add_argument('-l', default='none', dest='file', help='Provide a list of usernames to check <REQUIRED>', type=str)
parser.add_argument('-o', default='none', dest='output', help='Provide a filename to save the results <OPTIONAL>', type=str)
args = parser.parse_args()

usernames = []
exists = []
confirm = "\"IfExistsResult\":5"
confirm2 = "\"IfExistsResult\":0"
url = 'https://login.microsoftonline.com/common/GetCredentialType?mkt=en-US'

if args.file == "none":
	print("[!] No list provided. Please use '-l FILE'")
	print("[!] Quitting")
	quit()

with open(args.file, "r") as file:
	for name in file:
		usernames.append(name[:-1])
if args.output == "none":
	print("\n[!] Output filename not specified. Results will not be saved")
print("\n[+] Valid Microsoft account usernames found:\n")
for user in usernames:
	myobj = "{\"username\":\""+user+"\", \"isOtherIdpSupported\":true, \"country\":\"GB\"}"
	x = requests.post(url, data = myobj)
	for line in x:
		string = str(line)
		if confirm in string or confirm2 in string:
			print(user)
			exists.append(user)

if args.output != "none":
	with open(args.output, "w") as outfile:
		for i in exists:
			outfile.write(i)
			outfile.write("\n")
	print("\n[+]",len(exists),"usernames written to",args.output)
