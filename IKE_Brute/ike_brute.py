#brute-forces IKE group names
#github.com/the-jcksn

import os
import argparse
from subprocess import PIPE, Popen
from termcolor import colored

def cmdline(command):
        process = Popen(
                args=command,
                stdout=PIPE,
                shell=True
        )
        return process.communicate()[0]


parser = argparse.ArgumentParser()
parser.add_argument('-w', default='none', dest='wordlist', help='Provide a wordlist of Group Names for bruteforcing',type=str)
parser.add_argument('-ip', default='none', dest='ip', help='Provide target IP address',type=str)
args = parser.parse_args()

if not 'SUDO_UID' in os.environ.keys():
        print('This script requires super user privs, please run again with sudo')
        quit()
if args.ip == 'none':
        print('No target IP specified with -\'ip\' - Quitting')
        quit()
if args.wordlist == 'none':
        print('No wordlist provided with \'-w\' - Quitting')
        quit()

valid = []
attempt = 'empty'
ikescan = 'sudo ike-scan -M -A -n ' + attempt + ' ' + args.ip
wordlist = args.wordlist

wl_length = 0
with open(wordlist, 'r') as lengthcheck:
        for line in lengthcheck:
                wl_length += 1
print('\nStarting Ike-Brute...')
print('\nChecking',wl_length,'group names against',args.ip,':\n')

with open(wordlist, 'r') as input:
        for line in input:
                line = line[:-1]
                attempt = line
                output = cmdline(ikescan)
                string = '1 returned notify'
                string2 = '1 returned handshake'
                output_text = str(output)
                if string in output_text:
                        print(line, colored(' - failed','red'))
                if string2 in output_text:
                        print(colored(line,'green'),colored('- success!','green'))
                        valid.append(line)
if len(valid) < 1:
        print('\nNo valid Group names found')
else:
        print(colored('\nValid Group Names:','green'))
        print('------------------')
        for line in valid:
                print(line)
